<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„å…¨æ ˆè¿ç»´ç»ƒä¹ </title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        h1 { color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .status-box { background: #e8f5e9; padding: 15px; border-radius: 5px; color: #2e7d32; margin-bottom: 20px;}
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        .tag { padding: 4px 8px; border-radius: 4px; font-size: 0.85em; }
        .done { background: #d1fae5; color: #065f46; }
        .todo { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

    <h1>ğŸ“‹ ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ</h1>
    
    <div id="status" class="status-box">æ­£åœ¨è¿æ¥åç«¯ API...</div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>ä»»åŠ¡å†…å®¹</th>
                <th>çŠ¶æ€</th>
            </tr>
        </thead>
        <tbody id="task-list">
            <!-- è¿™é‡Œçš„ JavaScript ä¼šè‡ªåŠ¨å¡«å…¥æ•°æ® -->
        </tbody>
    </table>

    <script>
        // 1. å®šä¹‰ API åœ°å€
        const apiUrl = '/api/tasks';

        // 2. è·å–æ•°æ®
        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP é”™è¯¯! çŠ¶æ€ç : ${response.status}`);
                }
                return response.json();
            })
            .then(res => {
                const statusBox = document.getElementById('status');
                const list = document.getElementById('task-list');

                // æ˜¾ç¤ºè¿æ¥æˆåŠŸä¿¡æ¯
                statusBox.textContent = `âœ… åç«¯è¿æ¥æˆåŠŸï¼æ•°æ®æ¥æºï¼š${res.source || 'MySQL æ•°æ®åº“'}`;
                
                // 3. æ¸²æŸ“åˆ—è¡¨
                list.innerHTML = ''; // æ¸…ç©ºæ—§æ•°æ®
                res.data.forEach(task => {
                    const row = document.createElement('tr');
                    const statusHtml = task.status 
                        ? '<span class="tag done">å·²å®Œæˆ</span>' 
                        : '<span class="tag todo">å¾…åŠ</span>';
                    
                    row.innerHTML = `
                        <td>${task.id}</td>
                        <td>${task.content}</td>
                        <td>${statusHtml}</td>
                    `;
                    list.appendChild(row);
                });
            })
            .catch(error => {
                const statusBox = document.getElementById('status');
                statusBox.textContent = `âŒ è¿æ¥å¤±è´¥: ${error.message}`;
                statusBox.style.backgroundColor = '#fee2e2';
                statusBox.style.color = '#991b1b';
            });
    </script>
</body>
</html>

